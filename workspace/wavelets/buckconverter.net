# Buck Converter

.options sparse=1 maxdelta=5. softiter=100 maxiter=200 verbose=0 errfunc=0 reltol = 1e-4  abstol = 1e-7
#32.2581ms
#.analysis tran tstep=1ms tstop=100s
#.analysis ssw T=16.6667us nsamples=128 shell=0 deriv=Fourier multilevel=false wavelet='db4' method='Classical'
.analysis ssw T=5000us nsamples=80 shell=0 deriv=Fourier multilevel=false wavelet=none
#step=True
#.analysis sssw T=5000ms nsamples=80 shell=0 deriv=Fourier multilevel=false wavelet='haar' method='SenseRect'
# step=True
#.analysis sstd T=16.6667us nsamples=256 shell=0 deriv=Fourier
vdc:vin 1 gnd vdc=12V

#vpulse:gate 4 gnd v1=0V v2=20V td=0ms pw=2ms per=32.2581ms
#vpulse:gate 4 gnd v1=0V v2=20V td=0ms pw=200us per=400us
vpulse:gate 4 gnd v1=0V v2=12V td=0ms tf=20ns tr=20ns pw=5ms per=10ms

res:rl 3 gnd r=10
res:pot 3 gnd r=10k

cap:c1 3 gnd c=.5mF

ind:l1 2 3 l=30H

diode:MUR1520 gnd 2 isat=3.22361e-06 rs=0.0101677 n=2 eg0=1.21579 xti=3.00528 bv=200 ibv=0.00001 cj0=5.43127e-10 vj=0.4 m=0.373455 fc=0.5 tt=3.24606e-08 kf=0 af=1

xamp1 1 4 2 2 IRF540

.subckt IRF540 1 2 3 B

* Node 1 -> Drain
* Node 2 -> Gate
* Node 3 -> Source
ekv_i:M1 9 7 8 8 model=MM l=2u w=100u

.model MM ekv_i(vt0=3.56362 Lambda=0.00291031 kp=0.5e-3 type=n )

res:RS 8 3 r=0.0317085


diode:D1 3 1 model=MD

res:RDS 3 1 r=4e+06
res:RD 9 1 r=0.0135649
res:RG 2 7 r=5.11362


diode:D2 4 5 model=MD1

.model MD diode(isat=1.02194e-10 rs=0.00968022 n=1.21527 bv=100 \
ibv=0.00025 eg0=1.2 xti=3.03885 tt=1e-07 cj0=1.81859e-9 vj=1.1279 m=0.449161 \
fc=0.5)

.model MD1 diode(isat=1e-32 n=50 cj0=2.49697e-9 vj=0.5 m=0.9 fc=1e-08)

diode:D3 B 5 model=MD2

.model MD2 diode(isat=1e-10 n=0.4 rs=3e-06)

res:RL 5 10 r=1
#FI2 7 9 VFI2 -1

vdc:VFI2 4 B vdc=0

#EV16 10 B 9 7 1

cap:CAP 11 10 c=2.49697e-09
#FI1 7 9 VFI1 -1


vdc:VFI1 11 6 vdc=0V
res:RCAP 6 10 r=1

diode:D4 B 6 model=MD3

.model MD3 diode(isat=1e-10 n=0.4)

#FI2 4 0 7 9 CCVS
#EV16 10 0 9 7 VCVS
#FI1 11 6 7 9 CCVS

.subckt FI2 4 7 9
gyr:gin 7 9 vc0 vc1 g=1
vccs:g1 vc0 vc1 vc2 vc3 g=-1S
gyr:gout vc2 vc3 4 gnd g=1
.ends


.subckt FI1 11 6 7 9
gyr:gin 7 9 vc0 vc1 g=1
vccs:g1 vc0 vc1 vc2 vc3 g=-1S
gyr:gout vc2 vc3 11 6 g=1
.ends

.subckt EV16 10 9 7
vccs:g1 9 7 vc2 vc3 g=1S
gyr:gout vc2 vc3 10 gnd g=1
.ends

.ends



.plot ssw 1 2 3 4
.plot sstd 1 2 3 4
.plot tran 1 2 3 4
.plot tran 3
